{"version":3,"file":"component---src-templates-book-template-js-2294413c6ecdd679f2c3.js","mappings":"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","sources":["webpack://create-react-app/./src/components/Logo.js","webpack://create-react-app/./src/components/IconSettings.js","webpack://create-react-app/./src/templates/BookTemplate.module.css","webpack://create-react-app/./src/templates/BookTemplate.js"],"sourcesContent":["import React from \"react\";\n\nexport default function Logo(props) {\n  const { className } = props;\n\n  return (\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      viewBox=\"0 0 512 512\"\n      className={className}\n    >\n      <path d=\"M226.37 219.76a23.68 23.68 0 00-23.65 23.65 7.5 7.5 0 1015 0 8.66 8.66 0 0117.3 0 7.5 7.5 0 1015 0 23.68 23.68 0 00-23.65-23.65z\" />\n      <path d=\"M70.9 311.78c0-51.85 20.2-100.6 56.87-137.25a197.35 197.35 0 0118.49-16.3 192.56 192.56 0 01118.69-40.5h.1c54.67.03 107.11 23.63 143.86 64.74a7.5 7.5 0 1011.19-10 208.89 208.89 0 00-131.45-68.35c-6.8-32.69-21-64.3-40.34-89.58A36.8 36.8 0 00223.78.33a36.8 36.8 0 00-27.39 7.3 37.23 37.23 0 00-14.5 29 210.13 210.13 0 00-34.33-16.27c-19.48-7.11-41.11 2.52-48.22 21.48a36.78 36.78 0 001.07 28.58 37.3 37.3 0 005.03 8.02h-.17a36.79 36.79 0 00-26.69 9.55 36.8 36.8 0 00-12.12 25.63 37.08 37.08 0 0035.19 38.8 135.8 135.8 0 0124.07 3.42c-2.9 2.61-5.77 5.3-8.56 8.08A207.67 207.67 0 0055.9 311.78c0 39.73-16.47 108.57-16.63 109.26l-.1.45a77.27 77.27 0 0015.03 60.68 7.49 7.49 0 0010.53 1.33 7.5 7.5 0 001.32-10.52 62.24 62.24 0 01-12.14-48.66c1.25-5.25 17-71.82 17-112.54zm31.48-174.34a22.06 22.06 0 01-20.93-23.1 21.9 21.9 0 017.2-15.24c4.37-3.96 10.01-5.98 15.88-5.68 8.05.39 16.32 1.35 24.57 2.84a9.25 9.25 0 005.28-17.6c-2.58-1.1-5.2-2.13-7.8-3.07-5.6-2-10.06-6.08-12.56-11.48a21.89 21.89 0 01-.63-17c4.15-11.1 17.45-16.89 29.03-12.66a200.24 200.24 0 0143.9 22.73 8.62 8.62 0 0010.42-.57 8.62 8.62 0 002.2-10.2 22.14 22.14 0 016.57-26.87 21.87 21.87 0 0116.3-4.34 21.89 21.89 0 0114.59 8.46c17.15 22.42 29.96 50.26 36.62 79.25a205 205 0 00-7.96-.18h-.11c-45.65 0-89.07 14.54-124.97 41.43a154.91 154.91 0 00-37.6-6.72z\" />\n      <path d=\"M346.83 327.22l.52-2.85h14.03a15.59 15.59 0 0015.38-18.4 68.18 68.18 0 00-67.14-56.1H289.9a28.67 28.67 0 00-28.63 28.63v45.81c0 8.93 3.56 17.03 9.32 22.98a100.26 100.26 0 01-16.69 30.77 25.62 25.62 0 0020 41.52c7.85 0 15.15-3.51 20.03-9.64 3.07-3.86 5.95-7.85 8.62-11.96 2.67 4.1 5.55 8.1 8.62 11.96a25.47 25.47 0 0020.03 9.64c5.76 0 11.41-1.97 15.93-5.57a25.62 25.62 0 004.07-35.95 99.96 99.96 0 01-16.34-29.73 36.61 36.61 0 0011.97-21.1zm-7.36 60.18a10.6 10.6 0 01-16.57 13.2 137.44 137.44 0 01-13.73-20.88 7.5 7.5 0 00-13.24 0c-3.88 7.28-8.5 14.3-13.74 20.87a10.54 10.54 0 01-14.87 1.69 10.6 10.6 0 01-1.69-14.88 114.4 114.4 0 0017.94-31.82c3.38 1.16 7 1.8 10.77 1.8h16.39c3.76 0 7.4-.57 10.85-1.64a114.4 114.4 0 0017.89 31.66zm-63.2-63.03h55.83l-.03.19a21.67 21.67 0 01-21.34 17.83h-16.39a18.09 18.09 0 01-18.07-18.02zm0-15V278.5c0-7.52 6.12-13.64 13.63-13.64h19.72A53.2 53.2 0 01362 308.63a.6.6 0 01-.14.51c-.18.23-.4.23-.48.23h-85.11z\" />\n      <path d=\"M442.02 201.73a7.5 7.5 0 00-12.73 7.93 196.58 196.58 0 0129.7 104.05V434.9a62.18 62.18 0 01-62.1 62.1c-31.82 0-48.09-20.88-56.13-38.4a14.72 14.72 0 00-13.5-8.63h-.02a14.7 14.7 0 00-13.5 8.6c-8.1 17.53-24.42 38.43-56.06 38.43a62.25 62.25 0 01-58.5-41.22 15.25 15.25 0 00-13.2-10.15 15.26 15.26 0 00-14.74 7.73c-22.73 40.03-48.98 45.31-67.03 42.67a62.23 62.23 0 01-15.56-4.94 7.5 7.5 0 00-6.38 13.58 77.2 77.2 0 0019.64 6.18c32.09 4.76 61.34-13.03 82.38-50.08.06-.12.13-.21.4-.2.27.03.31.13.36.26A77.28 77.28 0 00257.68 512c30.78 0 55.46-16.64 69.56-46.88C341.23 495.35 365.95 512 396.9 512c42.51 0 77.1-34.59 77.1-77.1V313.7c0-39.67-11.05-78.39-31.97-111.97z\" />\n      <path d=\"M386.94 250.91a7.5 7.5 0 007.5-7.5 23.68 23.68 0 00-23.65-23.65 23.68 23.68 0 00-23.66 23.65 7.5 7.5 0 1015 0 8.66 8.66 0 0117.31 0 7.5 7.5 0 007.5 7.5z\" />\n    </svg>\n  );\n}\n","import React from \"react\";\n\nexport default function IconSettings(props) {\n  const { className } = props;\n\n  return (\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      viewBox=\"0 0 512 512\"\n      className={className}\n    >\n      <path d=\"M272.07 512h-32.14a47.19 47.19 0 01-47.13-47.13V454a206.7 206.7 0 01-32.1-13.33l-7.7 7.7c-18.66 18.69-48.55 18.14-66.67 0l-22.7-22.71c-18.16-18.13-18.68-48 0-66.66l7.7-7.7A206.71 206.71 0 0158 319.2H47.13A47.19 47.19 0 010 272.07v-32.14a47.19 47.19 0 0147.13-47.13H58a206.75 206.75 0 0113.33-32.1l-7.7-7.7c-18.67-18.65-18.16-48.53 0-66.66l22.71-22.72a47.13 47.13 0 0166.67 0l7.7 7.7A206.9 206.9 0 01192.8 58V47.13A47.19 47.19 0 01239.93 0h32.14a47.19 47.19 0 0147.13 47.13V58a206.7 206.7 0 0132.1 13.33l7.7-7.7c18.66-18.69 48.55-18.14 66.67 0l22.7 22.71c18.16 18.13 18.68 48 0 66.67l-7.7 7.7A206.71 206.71 0 01454 192.8h10.87A47.19 47.19 0 01512 239.93v32.14a47.19 47.19 0 01-47.13 47.13H454a206.75 206.75 0 01-13.33 32.1l7.7 7.7c18.67 18.65 18.16 48.53 0 66.67l-22.71 22.7a47.13 47.13 0 01-66.67 0l-7.7-7.7A206.9 206.9 0 01319.2 454v10.87A47.19 47.19 0 01272.07 512zM165.72 409.17a176.81 176.81 0 0045.83 19.02 15 15 0 0111.25 14.53v22.15c0 9.44 7.69 17.13 17.13 17.13h32.14c9.44 0 17.13-7.69 17.13-17.13v-22.15a15 15 0 0111.25-14.53 176.81 176.81 0 0045.83-19.02 15 15 0 0118.25 2.3l15.69 15.7a17.13 17.13 0 0024.22 0l22.73-22.72a17.13 17.13 0 000-24.23l-15.7-15.7a15 15 0 01-2.3-18.24 176.78 176.78 0 0019.03-45.83 15 15 0 0114.52-11.25h22.15c9.44 0 17.13-7.68 17.13-17.13v-32.14c0-9.44-7.69-17.13-17.13-17.13h-22.15a15 15 0 01-14.52-11.25 176.82 176.82 0 00-19.03-45.83 15 15 0 012.3-18.24l15.7-15.7a17.13 17.13 0 000-24.22l-22.72-22.72a17.13 17.13 0 00-24.23 0l-15.7 15.69a15 15 0 01-18.24 2.3 176.81 176.81 0 00-45.83-19.02 15 15 0 01-11.25-14.53V47.13c0-9.44-7.69-17.13-17.13-17.13h-32.14a17.15 17.15 0 00-17.13 17.13v22.15a15 15 0 01-11.25 14.53 176.81 176.81 0 00-45.83 19.02 15 15 0 01-18.25-2.3l-15.68-15.7a17.13 17.13 0 00-24.23 0l-22.72 22.73a17.13 17.13 0 00-.01 24.22l15.7 15.7a15 15 0 012.3 18.24 176.78 176.78 0 00-19.02 45.83 15 15 0 01-14.53 11.25H47.13A17.15 17.15 0 0030 239.93v32.14c0 9.44 7.69 17.13 17.13 17.13h22.15a15 15 0 0114.52 11.25 176.82 176.82 0 0019.03 45.83 15 15 0 01-2.3 18.24l-15.7 15.7a17.13 17.13 0 000 24.22l22.72 22.72a17.13 17.13 0 0024.23 0l15.7-15.69c3.56-3.56 10.98-6.59 18.24-2.3z\" />\n      <path d=\"M256 367.4c-61.43 0-111.4-49.97-111.4-111.4S194.57 144.6 256 144.6 367.4 194.57 367.4 256 317.43 367.4 256 367.4zm0-192.8c-44.88 0-81.4 36.52-81.4 81.4s36.52 81.4 81.4 81.4 81.4-36.52 81.4-81.4-36.52-81.4-81.4-81.4z\" />\n    </svg>\n  );\n}\n","// extracted by mini-css-extract-plugin\nexport var footer = \"BookTemplate-module--footer--mRAeM\";\nexport var footerNavButton = \"BookTemplate-module--footerNavButton--o+QWW\";\nexport var header = \"BookTemplate-module--header--4udBQ\";\nexport var headerBackIcon = \"BookTemplate-module--headerBackIcon--0k6rd\";\nexport var headerBackLink = \"BookTemplate-module--headerBackLink--pFjGl\";\nexport var headerButton = \"BookTemplate-module--headerButton--AOZcV\";\nexport var headerHidden = \"BookTemplate-module--headerHidden--HHAj3\";\nexport var headerIcon = \"BookTemplate-module--headerIcon--0XrgX\";\nexport var headerLeftSection = \"BookTemplate-module--headerLeftSection--fHNou\";\nexport var headerNavButton = \"BookTemplate-module--headerNavButton--fAKBJ\";\nexport var headerRightSection = \"BookTemplate-module--headerRightSection--hPdRu\";\nexport var headerTitle = \"BookTemplate-module--headerTitle--Ba0Qi\";\nexport var page = \"BookTemplate-module--page--767ks\";\nexport var pageImage = \"BookTemplate-module--pageImage--jAHaD\";\nexport var pagePadding = \"BookTemplate-module--pagePadding--vQxtc\";\nexport var pageSpanHeight = \"BookTemplate-module--pageSpanHeight--+tUNP\";\nexport var pageSpanWidth = \"BookTemplate-module--pageSpanWidth--NH2X7\";\nexport var pageWebtoon = \"BookTemplate-module--pageWebtoon--6scOl\";\nexport var pageWrapper = \"BookTemplate-module--pageWrapper--oPmzd\";","import React, {\n  useMemo,\n  useEffect,\n  useState,\n  useRef,\n  useCallback,\n} from \"react\";\nimport { graphql, Link } from \"gatsby\";\nimport { useInView } from \"react-intersection-observer\";\nimport classnames from \"classnames\";\n\nimport { decryptBuffer, createBlobUrl } from \"../utils/crypto\";\nimport { fetchWithRetries } from \"../utils/fetch\";\nimport { decrypt } from \"../utils/string\";\nimport Layout from \"../components/Layout\";\nimport Logo from \"../components/Logo\";\nimport IconSettings from \"../components/IconSettings\";\nimport Image from \"../components/Image\";\nimport useLocalStorage from \"../hooks/useLocalStorage\";\nimport useWindowSize from \"../hooks/useWindowSize\";\n\nimport * as styles from \"./BookTemplate.module.css\";\n\nconst READING_MODE_KEY = \"reading_mode\";\nconst READING_MODE_WIDTH = \"0\";\nconst READING_MODE_HEIGHT = \"1\";\nconst READING_MODE_WEBTOON = \"2\";\nconst READING_MODE_COUNT = 3;\n\nexport default function BookTemplate(props) {\n  const {\n    data: {\n      bookMeta: { dimensions, name },\n      bookPages,\n    },\n    pageContext: { prevPath, nextPath },\n  } = props;\n  const decryptedName = useMemo(() => decrypt(name), [name]);\n  const [readingMode, setReadingMode] = useLocalStorage(\n    READING_MODE_KEY,\n    READING_MODE_WIDTH\n  );\n  const { width: windowWidth, height: windowHeight } = useWindowSize();\n  const [navHidden, setNavHidden] = useState(true);\n\n  const goBack = useCallback((pageIndex) => {\n    const currentPageEl = document.getElementById(`page-${pageIndex}`);\n    const currentPageTop = currentPageEl.getBoundingClientRect().top;\n    if (currentPageTop < -5) {\n      currentPageEl.scrollIntoView();\n    } else if (pageIndex > 0) {\n      const prevPageEl = document.getElementById(`page-${pageIndex - 1}`);\n      prevPageEl.scrollIntoView();\n    }\n  }, []);\n\n  const goForward = useCallback((pageIndex) => {\n    const currentPageEl = document.getElementById(`page-${pageIndex}`);\n    const currentPageTop = currentPageEl.getBoundingClientRect().top;\n    if (currentPageTop > 5) {\n      currentPageEl.scrollIntoView();\n    } else if (pageIndex < bookPages.edges.length - 1) {\n      const nextPageEl = document.getElementById(`page-${pageIndex + 1}`);\n      nextPageEl.scrollIntoView();\n    }\n  }, []);\n\n  useEffect(() => {}, [goBack, goForward]);\n\n  function onPageClick(e, pageIndex) {\n    const windowWidth = window.innerWidth;\n    const clickX = e.clientX;\n    if (clickX < windowWidth / 10) {\n      goBack(pageIndex);\n    } else if (clickX < (9 * windowWidth) / 10) {\n      setNavHidden((flag) => !flag);\n    } else {\n      goForward(pageIndex);\n    }\n  }\n\n  function onSettingsButtonClick() {\n    setReadingMode(String((parseInt(readingMode) + 1) % READING_MODE_COUNT));\n  }\n\n  return (\n    <Layout>\n      <Header\n        title={decryptedName}\n        hidden={navHidden}\n        onSettingsButtonClick={onSettingsButtonClick}\n        {...{ prevPath, nextPath }}\n      />\n      {bookPages.edges.map(({ node: { publicURL } }, index) => {\n        const [pageWidth, pageHeight] = dimensions[index];\n        return (\n          <Page\n            {...{\n              index,\n              pageHeight,\n              pageWidth,\n              publicURL,\n              readingMode,\n              windowHeight,\n              windowWidth,\n              onPageClick,\n            }}\n            key={publicURL}\n          />\n        );\n      })}\n      <div className={styles.footer}>\n        {prevPath != null ? (\n          <Link to={prevPath} className={styles.footerNavButton}>\n            PREV\n          </Link>\n        ) : null}\n        {nextPath != null ? (\n          <Link to={nextPath} className={styles.footerNavButton}>\n            NEXT\n          </Link>\n        ) : null}\n      </div>\n    </Layout>\n  );\n}\n\nfunction Header(props) {\n  const { title, hidden, onSettingsButtonClick, prevPath, nextPath } = props;\n  const headerClassName = classnames(styles.header, {\n    [styles.headerHidden]: hidden,\n  });\n\n  return (\n    <div className={headerClassName}>\n      <div className={styles.headerLeftSection}>\n        <Link to=\"/\" className={styles.headerBackLink}>\n          <Logo className={styles.headerBackIcon} />\n        </Link>\n        <div>\n          <p className={styles.headerTitle}>{title}</p>\n        </div>\n        {prevPath != null ? (\n          <Link to={prevPath} className={styles.headerNavButton}>\n            PREV\n          </Link>\n        ) : null}\n        {nextPath != null ? (\n          <Link to={nextPath} className={styles.headerNavButton}>\n            NEXT\n          </Link>\n        ) : null}\n      </div>\n      <div className={styles.headerRightSection}>\n        <button className={styles.headerButton} onClick={onSettingsButtonClick}>\n          <IconSettings className={styles.headerIcon} />\n        </button>\n      </div>\n    </div>\n  );\n}\n\nfunction Page(props) {\n  const {\n    index,\n    pageHeight,\n    pageWidth,\n    publicURL,\n    readingMode,\n    windowHeight,\n    windowWidth,\n    onPageClick,\n  } = props;\n  const [imageBuffer, setImageBuffer] = useState(null);\n  const [blobUrl, setBlobUrl] = useState(null);\n  const onceRef = useRef(false);\n  const { ref, inView } = useInView({\n    rootMargin: `${windowHeight * 2.5}px 0px ${windowHeight * 3.5}px`,\n  });\n\n  useEffect(() => {\n    async function fetchImage() {\n      const res = await fetchWithRetries(publicURL, 1000, 5);\n      const buffer = await res.arrayBuffer();\n      setImageBuffer(decryptBuffer(buffer));\n    }\n    if (inView && !onceRef.current) {\n      fetchImage();\n      onceRef.current = true;\n    }\n  }, [inView, publicURL]);\n\n  useEffect(() => {\n    if (inView) {\n      setBlobUrl(createBlobUrl(imageBuffer));\n    }\n\n    return () => {\n      if (blobUrl != null) {\n        URL.revokeObjectURL(blobUrl);\n      }\n    };\n  }, [imageBuffer, inView]);\n\n  const windowRatio = windowHeight / windowWidth;\n  const pageRatio = pageHeight / pageWidth;\n\n  const shouldSpanWidth = readingMode !== READING_MODE_HEIGHT;\n\n  const pageClassName = classnames(styles.page, {\n    [styles.pageSpanWidth]: shouldSpanWidth,\n    [styles.pageSpanHeight]: !shouldSpanWidth,\n    [styles.pageWebtoon]: readingMode === READING_MODE_WEBTOON,\n  });\n\n  return (\n    <div\n      className={pageClassName}\n      id={`page-${index}`}\n      ref={ref}\n      onClick={(e) => onPageClick(e, index)}\n    >\n      <div\n        className={styles.pageWrapper}\n        style={\n          !shouldSpanWidth\n            ? {\n                width:\n                  pageRatio < windowRatio ? \"100%\" : `${100 / pageRatio}vh`,\n              }\n            : undefined\n        }\n      >\n        {shouldSpanWidth ? (\n          <div\n            className={styles.pagePadding}\n            style={{\n              paddingTop: `${pageRatio * 100}%`,\n            }}\n          />\n        ) : null}\n        {inView && blobUrl != null ? (\n          <Image className={styles.pageImage} src={blobUrl} />\n        ) : null}\n      </div>\n    </div>\n  );\n}\n\nexport const pageQuery = graphql`\n  query BookByName($name: String!) {\n    bookMeta: json(name: { eq: $name }) {\n      dimensions\n      name\n    }\n    bookPages: allFile(\n      sort: { fields: relativePath }\n      filter: {\n        relativeDirectory: { eq: $name }\n        extension: { nin: [\"json\"] }\n        name: { regex: \"/^(?!thumbnail).*/\" }\n      }\n    ) {\n      edges {\n        node {\n          relativePath\n          publicURL\n          name\n        }\n      }\n    }\n  }\n`;\n"],"names":["Logo","props","className","xmlns","viewBox","d","IconSettings","footerNavButton","headerNavButton","BookTemplate","data","bookMeta","dimensions","name","bookPages","pageContext","prevPath","nextPath","decryptedName","useMemo","decrypt","useLocalStorage","readingMode","setReadingMode","useWindowSize","windowWidth","width","windowHeight","height","useState","navHidden","setNavHidden","goBack","useCallback","pageIndex","currentPageEl","document","getElementById","getBoundingClientRect","top","scrollIntoView","goForward","edges","length","onPageClick","e","window","innerWidth","clickX","clientX","flag","useEffect","Layout","Header","title","hidden","onSettingsButtonClick","String","parseInt","map","index","publicURL","node","pageWidth","pageHeight","Page","key","Link","to","styles","headerClassName","classnames","onClick","imageBuffer","setImageBuffer","blobUrl","setBlobUrl","onceRef","useRef","useInView","rootMargin","ref","inView","fetchWithRetries","res","arrayBuffer","buffer","decryptBuffer","current","fetchImage","createBlobUrl","URL","revokeObjectURL","windowRatio","pageRatio","shouldSpanWidth","pageClassName","id","style","undefined","paddingTop","Image","src"],"sourceRoot":""}